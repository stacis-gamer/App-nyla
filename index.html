<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Nyla ðŸ’œ</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

html, body {
  width: 100%;
  height: 100%;
}

body {
  background: #0f0f1a;
  color: #e4e4e7;
  overflow: hidden;
}

/* ===== APP WRAPPER ===== */
.app {
  position: fixed;
  inset: 0;
  max-width: 720px;
  margin: 0 auto;
  background: #16161f;
  display: flex;
  flex-direction: column;
}

/* ===== HEADER ===== */
.header {
  padding: 16px;
  background: #1a1a26;
  border-bottom: 1px solid #2a2a3a;
  display: flex;
  gap: 12px;
  align-items: center;
}

.avatar {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: linear-gradient(135deg, #e879f9, #a78bfa);
  display: grid;
  place-items: center;
  font-weight: bold;
}

.status {
  font-size: 12px;
  color: #a78bfa;
}

/* ===== MESSAGES ===== */
.messages {
  flex: 1 1 auto;
  min-height: 0;
  overflow-y: auto;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.msg {
  max-width: 75%;
  padding: 12px 14px;
  border-radius: 16px;
  font-size: 15px;
  animation: pop 0.25s ease;
}

@keyframes pop {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

.user {
  align-self: flex-end;
  background: linear-gradient(135deg, #e879f9, #a78bfa);
  color: #fff;
  border-bottom-right-radius: 4px;
}

.nyla {
  align-self: flex-start;
  background: #1e1e2e;
  border-bottom-left-radius: 4px;
}

.emotion {
  font-size: 11px;
  opacity: 0.6;
  margin-top: 4px;
  color: #a78bfa;
}

/* ===== TYPING ===== */
.typing {
  display: flex;
  gap: 6px;
}

.dot {
  width: 6px;
  height: 6px;
  background: #a78bfa;
  border-radius: 50%;
  animation: bounce 1.2s infinite;
}

.dot:nth-child(2){animation-delay:.15s}
.dot:nth-child(3){animation-delay:.3s}

@keyframes bounce {
  0%,80%,100%{opacity:.4}
  40%{opacity:1}
}

/* ===== INPUT ===== */
.input {
  padding: 14px;
  background: #1a1a26;
  border-top: 1px solid #2a2a3a;
  display: flex;
  gap: 10px;
}

.input input {
  flex: 1;
  background: transparent;
  border: none;
  outline: none;
  color: #e4e4e7;
  font-size: 15px;
}

.input button {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: none;
  background: linear-gradient(135deg, #e879f9, #a78bfa);
  color: white;
  font-size: 18px;
}
</style>
</head>

<body>

<div class="app">
  <div class="header">
    <div class="avatar">N</div>
    <div>
      <h2>Nyla</h2>
      <div class="status">online</div>
    </div>
  </div>

  <div class="messages" id="messages"></div>

  <div class="input">
    <input id="input" placeholder="Message Nyla..." autocomplete="off">
    <button id="send">âž¤</button>
  </div>
</div>

<script>
const supabase = window.supabase.createClient(
  "https://sjwwkmjfehsondqbmouu.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNqd3drbWpmZWhzb25kcWJtb3V1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2MzE5MzksImV4cCI6MjA4MTIwNzkzOX0.cgooAxM2BXisi20RH-cKqardpt432dPAs1EI_mVqV0U"
);

const API = "https://nyla-api.onrender.com/nyla";

const messages = document.getElementById("messages");
const input = document.getElementById("input");
const send = document.getElementById("send");

send.onclick = sendMessage;
input.onkeydown = e => e.key === "Enter" && sendMessage();

function addMessage(text, role, emotion) {
  const m = document.createElement("div");
  m.className = "msg " + role;
  m.textContent = text;

  if (emotion) {
    const e = document.createElement("div");
    e.className = "emotion";
    e.textContent = emotion;
    m.appendChild(e);
  }

  messages.appendChild(m);
  messages.scrollTop = messages.scrollHeight;
}

async function loadHistory() {
  const { data } = await supabase
    .from("messages")
    .select("*")
    .order("created_at");

  data?.forEach(m => addMessage(m.content, m.role, m.emotion));
}

async function sendMessage() {
  if (!input.value.trim()) return;
  const text = input.value;
  input.value = "";

  addMessage(text, "user");
  await supabase.from("messages").insert({ role: "user", content: text });

  const typing = document.createElement("div");
  typing.className = "msg nyla";
  typing.innerHTML = `<div class="typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
  messages.appendChild(typing);
  messages.scrollTop = messages.scrollHeight;

  try {
    const r = await fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text })
    });
    const d = await r.json();

    typing.remove();
    addMessage(d.reply, "nyla", d.emotion);

    await supabase.from("messages").insert({
      role: "nyla",
      content: d.reply,
      emotion: d.emotion
    });
  } catch {
    typing.remove();
    addMessage("I glitched ðŸ˜­", "nyla", "shocked");
  }
}

loadHistory();
</script>

</body>
</html>